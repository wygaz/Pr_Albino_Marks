{% extends 'base.html' %}
{% load static %}

{% block title %}Artigos ‚Äî Projeto Pr. Albino Marks{% endblock %}

{% block content %}
<div class="wrap artigos-page" data-theme="verde" data-size="normal">

  <!-- Cabe√ßalho -->
  <div class="page-head">
    <h1>Artigos</h1>
    <p class="sub">
      Explore os estudos do Pr. Albino Marks por √°rea de temas
    </p>

    <div class="actions">
      <a href="{% url 'A_Lei_no_NT:artigos_pdf' %}" class="btn ghost">
        üìÑ Gerar lista em PDF
      </a>
    </div>
  </div>

  <!-- CARD de filtros de √ÅREA -->
  {% if areas %}
  <div class="filters-card">

    <div class="filters-header">
      <span class="filters-title">Filtrar por √°rea</span>
    </div>

    <div class="area-tabs" aria-label="√Åreas de estudo">
      <button type="button" class="chip-area" data-area-key="all">
        Todas as √°reas
      </button>
      {% for area in areas %}
        <button type="button"
                class="chip-area{% if forloop.first %} active{% endif %}"
                data-area-key="area-{{ area.id }}">
          {{ area.nome }}
        </button>
      {% endfor %}
    </div>

    <div class="area-current">
      <span class="label">√Årea selecionada:</span>
      <span id="area-current-label">
        {% if areas %}{{ areas.0.nome }}{% else %}Todas as √°reas{% endif %}
      </span>
    </div>

  </div>
  {% endif %}

  <!-- LISTA DE ARTIGOS -->
  <ul class="article-table">
  {% for artigo in artigos %}
    <li class="article-row"
        data-area-key="{% if artigo.area_id %}area-{{ artigo.area_id }}{% else %}none{% endif %}">

      <!-- Coluna 1: miniatura -->
      <div class="col-thumb">
        {% if artigo.imagem_capa %}
          <img class="thumb" src="{{ artigo.imagem_capa.url }}" alt="Capa de {{ artigo.titulo }}" loading="lazy">
        {% else %}
          <img class="thumb" src="{% static 'Imagens/placeholder.jpg' %}" alt="Sem capa" loading="lazy">
        {% endif %}
      </div>

      <!-- Coluna 2: t√≠tulo + meta -->
      <div class="col-title">
        <a href="{% url 'A_Lei_no_NT:visualizar_artigo' artigo.slug %}" class="article-link">
          {{ artigo.titulo|title }}
        </a>
        <div class="article-meta">
          <span class="meta-label">Publicado em:</span>
          {% if artigo.publicado_em %}
            {{ artigo.publicado_em|date:"d 'de' F 'de' Y" }}
          {% else %}
            <span class="no-date">data n√£o informada</span>
          {% endif %}
        </div>
      </div>

      <!-- Coluna 3: a√ß√£o PDF -->
      <div class="col-actions">
        {% if artigo.arquivo_pdf %}
          <a class="btn-pdf" href="{% url 'A_Lei_no_NT:artigo_pdf_download' artigo.slug %}">üì• Baixar PDF</a>
        {% endif %}
      </div>

    </li>
  {% empty %}
    <li>Nenhum artigo encontrado</li>
  {% endfor %}
  </ul>

  {% if page_obj %}
  <div class="mt-4 text-center text-muted">
    <small>P√°gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</small>
  </div>
  {% endif %}
</div>

<style>
  /* N√ÉO escondemos mais a barra global de prefer√™ncias */
  /* .prefs-toolbar{display:none!important} */

  /* Escopo desta p√°gina */
  .artigos-page{
    --brand:   #3CB371;
    --brand-2: #3c8a52;
    --ink:     #111827;
    --muted:   #6b7280;
    --paper:   #fff;
    --edge:    #e5e7eb;
    --link:    #1f4e8c;
  }

  /* Cabe√ßalho centralizado */
  .artigos-page .page-head{
    text-align:center;
    margin:10px 0 16px;
  }
  .artigos-page .page-head h1{
    font-size:2.3rem;
    letter-spacing:.3px;
    margin:4px 0 2px;
  }
  .artigos-page .page-head .sub{
    color:var(--muted);
    font-size:.98rem;
    margin:0;
  }
  .artigos-page .page-head .actions{
    margin-top:12px;
  }

  /* CARD de filtros */
  .filters-card{
    margin:6px 0 16px;
    padding:10px 14px 12px;
    border-radius:14px;
    border:1px solid var(--edge);
    background:#f9fafb;
  }
  .filters-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:6px;
  }
  .filters-title{
    font-size:.9rem;
    font-weight:600;
    color:var(--ink);
  }

  /* Filtro de √Åreas */
  .area-tabs{
    display:flex;
    flex-wrap:wrap;
    gap:6px;
    margin:4px 0 4px;
  }
  .chip-area{
    border:1px solid var(--edge);
    background:#ffffff;
    color:var(--ink);
    padding:4px 10px;
    border-radius:999px;
    font-size:.82rem;
    cursor:pointer;
  }
  .chip-area:hover{background: #7ff2af}
  .chip-area.active{
    background:var(--brand);
    border-color:var(--brand);
    color: #F0E68C;
  }
  .area-current{
    margin-top:4px;
    font-size:.86rem;
    color:var(--muted);
  }
  .area-current .label{
    font-weight:600;
    margin-right:4px;
  }

  /* Tabela visual de artigos */
  .artigos-page .article-table{
    list-style:none;
    margin:14px 0 24px;
    padding:14px 0 0;
    border-top:1px solid var(--edge);
  }
  .artigos-page .article-row{
    display:grid;
    grid-template-columns:84px 1fr 180px;
    gap:16px;
    align-items:center;
    background:var(--paper);
    border:1px solid var(--edge);
    border-left:5px solid rgba(43,111,62,.18);
    border-radius:14px;
    padding:12px 16px;
    margin-bottom:12px;
    box-shadow:0 1px 2px rgba(16,24,40,.04);
  }
  .artigos-page .article-row:hover{
    border-left-color:var(--brand);
    box-shadow:0 6px 18px rgba(16,24,40,.08);
  }

  /* Miniatura */
  .artigos-page .thumb{
    width:64px;
    height:64px;
    border-radius:10px;
    object-fit:cover;
    display:block;
    background:linear-gradient(135deg,#e6f2ea,#f6faf7);
    border:1px solid var(--edge);
  }

  /* T√≠tulo/Meta */
  .artigos-page .article-link{
    color:var(--link);
    text-decoration:none;
    font-weight:600;
  }
  .artigos-page .article-link:hover{text-decoration:underline}
  .artigos-page .article-meta{
    color:var(--muted);
    font-size:.95rem;
    margin-top:2px;
  }
  .artigos-page .meta-label{
    font-weight:600;
    font-size:.85rem;
    margin-right:4px;
  }

  /* A√ß√µes (PDF √† direita) */
  .artigos-page .col-actions{
    display:flex;
    align-items:center;
    justify-content:flex-end;
  }
  .artigos-page .btn-pdf{
    display:inline-block;
    background:var(--brand);
    color:#fff;
    text-decoration:none;
    padding:8px 12px;
    border-radius:999px;
    font-weight:600;
    font-size:.95rem;
    white-space:nowrap;
  }
  .artigos-page .btn-pdf:hover{background:var(--brand-2)}

  @media (max-width:900px){
    .artigos-page .article-row{grid-template-columns:72px 1fr 150px}
  }
  @media (max-width:720px){
    .artigos-page .article-row{
      grid-template-columns:64px 1fr;
      grid-template-areas:
        "thumb title"
        "thumb actions";
      gap:10px;
    }
    .artigos-page .col-thumb{grid-area:thumb}
    .artigos-page .col-title{grid-area:title}
    .artigos-page .col-actions{grid-area:actions;justify-content:flex-start}
    .artigos-page .btn-pdf{width:100%;text-align:center}
  }
</style>

<script>
(function(){
  const root = document.querySelector('.artigos-page');
  if (!root) return;

  const areaKey  = 'artigosAreaFilter';
  const areaButtons = root.querySelectorAll('.chip-area');
  const rows        = root.querySelectorAll('.article-row');
  const currentLbl  = document.getElementById('area-current-label');

  function applyAreaFilter(key){
    localStorage.setItem(areaKey, key);
    areaButtons.forEach(btn=>{
      btn.classList.toggle('active', btn.dataset.areaKey === key);
    });

    rows.forEach(row=>{
      const rowKey = row.dataset.areaKey || 'none';
      if (key === 'all' || key === undefined){
        row.style.display = '';
      } else {
        row.style.display = (rowKey === key) ? '' : 'none';
      }
    });

    if (currentLbl){
      const active = Array.from(areaButtons).find(btn => btn.classList.contains('active'));
      currentLbl.textContent = active ? active.textContent.trim() : 'Todas as √°reas';
    }
  }

  areaButtons.forEach(btn=>{
    btn.addEventListener('click', ()=> applyAreaFilter(btn.dataset.areaKey));
  });

  const firstAreaBtn = Array.from(areaButtons).find(btn => btn.dataset.areaKey && btn.dataset.areaKey !== 'all');
  const defaultAreaKey = firstAreaBtn ? firstAreaBtn.dataset.areaKey : 'all';
  const startArea = localStorage.getItem(areaKey) || defaultAreaKey;
  applyAreaFilter(startArea);
})();
</script>
{% endblock %}
